modelscript_version: 0.1
modelscript_primitives:
  - name: IntersectionLeaderFollowerModel
    from_taxonomic_primitive: IntersectionLeaderFollower
    export_attributes_to_model: true
    instance_aliases:
    - alias: C
      instances:
      - cp_lf_none
    scale_parameters:
      - name: clock
        type: real
        export_as_model_attribute: true
        inherit: true
      - name: technology
        type: string
        export_as_model_attribute: true
        inherit: true
    load_symbols:
      - port: md_in_leader
        symbol_types:
        - type: level
          load_tensors:
          - load_tensor: datatype
            load_ranks:
            - load_rank: metadata_word_width
          - load_tensor: coordinate
            load_ranks:
            - load_rank: dense_data_rank_size
            - load_rank: nodes_per_cycle
          - load_tensor: position
            load_ranks:
            - load_rank: positions_per_cycle
          - load_tensor: bandwidth
            load_ranks:
            - load_rank: metadata_read_width
        - type: peak
          load_tensors:
          - load_tensor: datatype
            load_ranks:
            - load_rank: metadata_word_width
          - load_tensor: position
            load_ranks:
            - load_rank: positions_per_cycle
          - load_tensor: bandwidth
            load_ranks:
            - load_rank: metadata_read_width
      - port: md_out
        symbol_types:
        - type: level
          load_tensors:
          - load_tensor: datatype
            load_ranks:
            - load_rank: metadata_word_width
          - load_tensor: coordinate
            load_ranks:
            - load_rank: dense_data_rank_size
            - load_rank: nodes_per_cycle
          - load_tensor: position
            load_ranks:
            - load_rank: positions_per_cycle
          - load_tensor: bandwidth
            load_ranks:
            - load_rank: metadata_read_width
        - type: peak
          load_tensors:
          - load_tensor: datatype
            load_ranks:
            - load_rank: metadata_word_width
          - load_tensor: position
            load_ranks:
            - load_rank: positions_per_cycle
          - load_tensor: bandwidth
            load_ranks:
            - load_rank: metadata_read_width
    actions:
      - name: fill
      - name: intersect
      - name: gated_fill
      - name: gated_intersect
    characterization_metric_models:
      - name: test_fxn
        approximation: poly
        table_id: accelergy/data/primitives_table.csv
        rtl_id_expression: BidirectionalCoordinatePayloadIntersectDecoupled_metaDataWidth$(u)
        symbol_map:
          - variable: u
            symbol: md_in_leader.peak.datatype.metadata_word_width
        latency:
          parameter_id: clock
          single_latency: true
          latency_column_name: critical_path_clock_latency
        energy:
          - expression: combinational_total_power+register_total_power+clock_network_total_power
            type: power
        area:
          - expression: Combinational_Area
            type: area
        generate_constraints: false
    implementations:
      - name: C
        taxonomic_instance_alias: C
        objective:
          actions:
            - name: fill
              energy: 2*(@md_out_rw_thresh + @md_out_pr_thresh + @md_out_ww_thresh + %(test_fxn))
            - name: intersect
              energy: 2*(@md_out_rw_thresh + @md_out_pr_thresh + @md_out_ww_thresh )
            - name: gated_fill
              energy: 0
            - name: gated_intersect
              energy: 0
          area: 1e-10*(@md_out_rw_thresh + @md_out_pr_thresh + @md_out_ww_thresh +
            %(test_fxn) )
        constraints:
          - type: characterization_metrics_model
            list:
            - test_fxn
          - type: passthrough
            list:
              - port_in: md_in_leader
                port_out: md_out
                suffixes:
                  - level.datatype.metadata_word_width
                  - level.coordinate.dense_data_rank_size
                  - level.coordinate.nodes_per_cycle
                  - level.position.positions_per_cycle
                  - level.bandwidth.metadata_read_width
          - type: values
            list:
#              - symbol: md_in_leader.peak.datatype.metadata_word_width
#                values:
#                  - 1
#                  - 8
#                  - 64
#                  - 256
              - symbol: md_out.peak.datatype.metadata_word_width
                values:
                  - 1
                  - 2
                  - 4
                  - 8
                  - 16
                  - 32
                  - 64
                  - 128
                  - 256
              - symbol: md_in_leader.peak.position.positions_per_cycle
                values:
                  - 1
                  - 8
                  - 64
                  - 256
              - symbol: md_out.peak.position.positions_per_cycle
                values:
                  - 1
                  - 8
                  - 64
                  - 256
              - symbol: md_in_leader.peak.bandwidth.metadata_read_width
                values:
                  - 1
                  - 8
                  - 64
                  - 256
              - symbol: md_out.peak.bandwidth.metadata_read_width
                values:
                  - 1
                  - 8
                  - 64
                  - 256
